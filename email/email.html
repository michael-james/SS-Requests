<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title></title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	   <link rel="stylesheet" type="text/css" href="styles.css">
       <div w3-include-html="../css.html"></div>
    </head>
    <body>
        <table border="0" cellpadding="0" cellspacing="0" height="100%" width="100%" id="bodyTable">
            <tr>
                <td align="center" valign="top">
                    <table border="0" cellpadding="20" cellspacing="0" id="emailContainer" style="max-width: 750px;">
                        <tr>
                            <td align="left" valign="top">
                            
<?  console.log('working...');
    console.log(d);
    var d = d || getRequest(66);
    console.log(d);
	var info = position(d.row); ?>


<h3><strong>SS Request Update</strong> / <?= d.id ?></h3>
<h3><?= d.status ?></h3>
<h4><?= d.client + ' ' + d.protocol + (d.batch && (' Batch ' + d.batch)) ?> &mdash; <?= d.reqCode ?></h4>
<h5 class="mb-4 text-secondary"><?= moment().format(ERTdf) ?></h5>

<p>
<? if (!d.dFiles && d.startDate) { ?>
	We <?= d.daysStart < 0 ? 'were' : 'are' ?> expecting your <strong>files</strong> <span class="text-info"><?= bdText(d.startDate && d.startDate.format(dfo), d.daysStart, 0) ?></span>. When they arrive, please place them on <strong><?= d.server.slice(4) ?></strong> at the file path* <u><?= d.server[0] ?>:/<?= d.client ?>/<?= d.protocol ?>/z - To Assistant/<strong><?= d.timestamp && d.timestamp.format("YYYY.MM.DD") ?> -- <?= d.id ?></strong></u> and <a href="<?=url?>?page=View&row=<?= d.row ?>" target="_blank">mark them as ready</a>.
<? } else if (!d.dREV) { ?>
	Please make sure your files are on <strong><?= d.server.slice(4) ?></strong> at the file path* <u><?= d.server[0] ?>:/<?= d.client ?>/<?= d.protocol ?>/z - To Assistant/<strong><?= d.timestamp && d.timestamp.format("YYYY.MM.DD") ?> -- <?= d.id ?></strong></u>.
<? } ?>
</p>

<p>
<? if (d.hardDueDate) { ?>
	Your <strong>hard</strong> deadline <?= bdText(d.hardDueDate && d.hardDueDate.format(dtfo), d.daysDue, 1) ?>.
<? } ?>

<? if (d.prefDueDate) { ?>
	Your <strong>preferred</strong> deadline <?= bdText(d.prefDueDate && d.prefDueDate.format(dfo), d.daysPref, 1) ?>.
<? } ?>

<? if (d.expRetDate && d.daysExp >= 0) { ?>
	We currently <strong>estimate</strong> that we will deliver the screenshots for your review <span class="text-info"><?= bdText(d.expRetDate && d.expRetDate.format(dfo), d.daysExp, 0) ?></span>.
<? } ?>
</p>

<p><span class="text-muted">
	This is the <strong><?= ord(info.pos) ?></strong> request in our queue.

<? if (info.posNotStart) { ?>
	It is the <strong><?= ord(info.posNotStart) ?></strong> request out of those we have not yet started.
<? } ?>

    <? if (info.wkbksBefore) { ?>
    	There are approximately <?= info.wkbksBefore ?> workbooks ahead of this request <?
    if (info.wkbksBeforeNotStart) { ?>
        (of which <?= info.wkbksBeforeNotStart ?> have not been started).
    <? } else { ?>.<? } ?>
<? } ?>
</span></p>

<p>
    Thank you,<br>
    The Assistants&trade;

<? if (!d.dRev) { ?>
<p>
	<span class="text-muted" style="font-size: 75%"><i>*It's ok if your file path is</i> slightly <i>different because of the way client/study folders are named.</i>
</p>
<? } ?>

<!-- <p style="white-space: pre-wrap;"><?= Logger.getLog() ?></p> -->

<table class="table table-striped table-sm" style="text-align: left">
  <thead class="thead-dark">
    <tr>
      <th scope="col" colspan="2">
        <table border="0" cellpadding="0" cellspacing="0" height="100%" width="100%">
            <tr border="0">
                <th><?= (d.client && (d.client + ' ')) + (d.protocol && (d.protocol + ' ')) + (d.batch && (' Batch ' + d.batch)) ?> &mdash; <?= d.reqCode ?></th>
                <th align="right" style="text-align: right"><?= d.id ?></th>
            </tr>
        </table>
      </th>
    </tr>    
  </thead>


  <tbody>
    <tr class="table-primary">
      <th scope="row">Status</th>
      <td><?= d.status ?></td>
    </tr>
    <tr>
      <th scope="row">Position in Queue</th>
      <td><?= ord(info.pos) ?></td>
    </tr>
    <tr>
      <th scope="row">Estimated Return Date</th>
      <td><?= (d.expRetDate && d.expRetDate.format(ldf)) || "(not estimated yet)" ?></td>
    </tr>
    <tr>
      <th scope="row">Assignee</th>
      <td><?= d.asst || "(not assigned)" ?></td>
    </tr>

    <tr class="table-dark">
      <th scope="col" colspan="2">Timeline</th>
    </tr>

<? if (d.dCPL) { ?>
    <tr>
      <th scope="row">Date Completed</th>
      <td><?= d.dCPL.format(ldtf) ?></td>
    </tr>

<? } if (d.hardDueDate) { ?>
    <tr>
      <th scope="row">Hard Deadline</th>
      <td><?= d.hardDueDate.format(ldtf) ?></td>
    </tr>

<? } if (d.prefDueDate) { ?>
    <tr>
      <th scope="row">Preferred Deadline</th>
      <td><?= d.prefDueDate.format(ldf) ?></td>
    </tr>

<? } if (d.dRet) { ?>
    <tr>
      <th scope="row">Request First Returned</th>
      <td><?= d.dRet.format(ldtf) ?></td>
    </tr>

<? } if (d.dINP) { ?>
    <tr>
      <th scope="row">Request Started</th>
      <td><?= d.dINP.format(ldtf) ?></td>
    </tr>

<? } if (d.dFiles) { ?>
    <tr>
      <th scope="row">Files Received</th>
      <td><?= d.dFiles.format(ldtf) ?></td>
    </tr>

<? } if (d.startDate) { ?>
    <tr>
      <th scope="row">Files Expected</th>
      <td><?= d.startDate.format(ldf) ?></td>
    </tr>

<? } if (d.timestamp) { ?>
    <tr>
      <th scope="row">Request Received</th>
      <td><?= d.timestamp.format(ldtf) ?></td>
    </tr>

<? } ?>




  </tbody>
</table>