<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title></title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	      <link rel="stylesheet" type="text/css" href="styles.css">
        <div w3-include-html="../css.html"></div>
        <style>
          /*Bootstrap*/

          .btn-group>.btn-group:not(:last-child)>.btn,.btn-group>.btn:not(:last-child):not(.dropdown-toggle){
              border-top-right-radius:0;
              border-bottom-right-radius:0
          }
          .btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){
              border-top-left-radius:0;
              border-bottom-left-radius:0
          }

          .btn-group-vertical>.btn-group:not(:last-child)>.btn,.btn-group-vertical>.btn:not(:last-child):not(.dropdown-toggle){
              border-bottom-right-radius:0;
              border-bottom-left-radius:0
          }
          .btn-group-vertical>.btn-group:not(:first-child)>.btn,.btn-group-vertical>.btn:not(:first-child){
              border-top-left-radius:0;
              border-top-right-radius:0
          }

          /*custom*/

          /*statuses*/

          .btn-inprogress {
              color: #212529;
              background-color: rgb(252, 229, 205);
            }
            
            .btn-assigned {
              color: rgb(246, 178, 107);
              background-color: transparent;
              border-color: rgb(246, 178, 107);
              background-image: none;
            }
            
            .btn-completed {
              color: #fff;
              background-color: #6aa84f;
              border-color: #6aa84f;
              background-image: none;
            }
            
            .btn.status {
              width: 50px;
              height: 31px;
            }
        </style>
    </head>
    <body>
        <table border="0" cellpadding="0" cellspacing="0" height="100%" width="100%" id="bodyTable">
            <tr>
                <td align="center" valign="top">
                    <table border="0" cellpadding="20" cellspacing="0" id="emailContainer" style="max-width: 750px;">
                        <tr>
                            <td align="left" valign="top">
                            
<?  console.log('working...');
    console.log(d);
    var d = d || getRequest(69);
    console.log(d);
	var info = position(d.row); ?>


<h3><strong>SS Request Update</strong> / <?= d.id ?></h3>
<h4><?= d.client + ' ' + d.protocol + (d.batch && (' Batch ' + d.batch)) ?> &mdash; <?= d.reqCode ?></h4>

<h3 class="mt-3"><?= d.status ?></h3>
<h5 class="mb-4 text-secondary"><?= moment().format(ERTdf) ?></h5>

<p>
    Hello<?= d.requestorNames && (" " + d.requestorNames[0]) ?>,
</p>

<!-- START OF DYNAMIC MESSAGE -->

<!-- UN-RESOLVED ISSUES message -->

<? if (d.statusCode == 'UNR') { ?>
    <p>There are <strong><span class="text-danger">unresolved issues</span></strong> that are keeping us from delivering your request. Please review the information below and take appropriate action.</p>
<? } ?>


<!-- PENDING CONFIRMATION message -->

<? if (d.statusCode == 'PND') {
    if (d.fileloc) { ?>
        <p>Your request is ready for delivery <strong><span class='text-success'>pending confirmation</span></strong>. Please review the notes below and the associated files at <u><?= d.fileloc ?></u> then select an option below.</p>
    <? } else { ?>
        <p>Your request is ready for delivery <strong><span class='text-success'>pending confirmation</span></strong>. Please review the notes below and the associated files then select an option below.</p>
    <? } ?>
    <div class="btn-group btn-group-sm mb-3" role="group">
      <a class="btn btn-inprogress" style="border-top-right-radius: 0!important; border-bottom-right-radius: 0!important" href="<?=url?>?page=View&row=<?= d.row ?>&status=INP">Needs Corrections</a>
      <a class="btn btn-warning" style="border-top-right-radius: 0!important; border-bottom-right-radius: 0!important; border-top-left-radius: 0!important; border-bottom-left-radius: 0!important" href="<?=url?>?page=View&row=<?= d.row ?>&status=ONH">On-hold</a>
      <a class="btn btn-completed" style="border-bottom-left-radius: 0!important; border-top-left-radius: 0!important; " href="<?=url?>?page=View&row=<?= d.row ?>&status=CPL">Completed</a>
    </div>
<? } ?>


<!-- ON-HOLD message -->

<? if (d.statusCode == 'ONH') {
    if (d.waitfor) { ?>
        <p style="white-space: pre-wrap">Your request was placed <strong><span class="text-warning">on-hold</span></strong> because it cannot continue until the following is resolved:<br><?= d.waitfor.trim() ?></p>
        <? if (d.jira) { ?>
            <p style="white-space: pre-wrap">There are associated JIRA defects:<br><?= d.jira.trim() ?></p>
        <? } ?>
    <? } else if (d.jira) { ?>
        <p style="white-space: pre-wrap">Your request was placed <strong><span class="text-warning">on-hold</span></strong> because it cannot continue until the following defect(s) are resolved:<br><?= d.jira.trim() ?></p>
    <? } else { ?>
        <p>Your request was placed <strong><span class="text-warning">on-hold</span></strong> because there is an unresolved issue that is currently being resolved.
            <? if (d.asst) { ?>
                <?= d.asst ?> will get in touch if your assistance is required.<? } else { ?>We will get in touch if your assistance is required.
            <? } ?></p>
    <? } ?>
<? } ?>


<!-- placing files on server -->

<!-- files not received -->
<? if (!d.dFiles && d.startDate) { ?>
	<p>We <?= d.daysStart < 0 ? 'were' : 'are' ?> expecting your <strong>files</strong> <span class="text-info"><?= bdText(d.startDate && d.startDate.format(dfo), d.daysStart, 0) ?></span>. When they arrive, please place them on <strong><?= d.server.slice(4) ?></strong> at the file path* <u><?= d.server[0] ?>:/<?= d.client ?>/<?= d.protocol ?>/z - To Assistant/<strong><?= d.timestamp && d.timestamp.format("YYYY.MM.DD") ?> -- <?= d.id ?></strong></u> and <a href="<?=url?>?page=View&row=<?= d.row ?>" class='text-success' target="_blank" style="text-decoration: underline;">mark them as ready</a>.</p>

<!-- files not reviewed -->
<? } else if (!(d.dREV || d.dINP || d.dRet || d.dONH)) { ?>
	<p>Please make sure your files are on <strong><?= d.server.slice(4) ?></strong> at the file path* <u><?= d.server[0] ?>:/<?= d.client ?>/<?= d.protocol ?>/z - To Assistant/<strong><?= d.timestamp && d.timestamp.format("YYYY.MM.DD") ?> -- <?= d.id ?></strong></u>.</p>
<? } ?>


<!-- estimated return -->


<? if (d.expRetDate && d.daysExp >= 0 && (d.statusCode !== 'ONH') && (d.statusCode !== 'UNR') && (d.statusCode !== 'CPL') && (d.statusCode !== 'PND') && (d.statusCode !== 'CAN')) { ?>
	<p>We currently <strong>estimate</strong> that we will deliver screenshots for your review <span class="text-info"><?= bdText(d.expRetDate && d.expRetDate.format(dfo), d.daysExp, 0) ?></span>.</p>
<? } ?>


<!-- END OF DYNAMIC MESSAGE -->


<p class="mb-4">
    Thank you,<br>
    The Assistants&trade;
</p>

<!-- Status Info -->

<p class="text-muted">
<? if (d.hardDueDate) { ?>
    Your <strong>hard</strong> deadline <?= bdText(d.hardDueDate && d.hardDueDate.format(dtfo), d.daysDue, 1) ?>.<br>
<? } ?>

<? if (d.prefDueDate) { ?>
    Your <strong>preferred</strong> deadline <?= bdText(d.prefDueDate && d.prefDueDate.format(dfo), d.daysPref, 1) ?>.
<? } ?>
</p>

<p class="text-muted">
    This is the <strong><?= ord(info.pos) ?></strong> request in our queue.

<? if (info.posNotStart) { ?>
    It is the <strong><?= ord(info.posNotStart) ?></strong> request out of those we have not yet started.
<? } ?>

    <? if (info.wkbksBefore) { ?>
        There are approximately <?= info.wkbksBefore ?> workbooks ahead of this request <?
    if (info.wkbksBeforeNotStart) { ?>
        (of which <?= info.wkbksBeforeNotStart ?> have not been started).
    <? } else { ?>.<? } ?>
<? } ?>
</p>

<? if (!(d.dREV || d.dINP || d.dRet || d.dONH)) { ?>
<p>
	<span class="text-muted" style="font-size: 75%"><i>*It's ok if your file path is</i> slightly <i>different because of the way client/study folders are named.</i>
</p>
<? } ?>


<!-- Summary Table -->

<table class="table table-striped table-sm mt-5" style="text-align: left;">
  <thead class="thead-dark"> <!-- style="background-color: #212529; border-color: #32383e" -->
    <tr>
      <th scope="col" colspan="2">
        <table border="0" cellpadding="0" cellspacing="0" height="100%" width="100%">
            <tr style="border: 0">
                <th class="py-2" style="border: 0!important"><?= (d.client && (d.client + ' ')) + (d.protocol && (d.protocol + ' ')) + (d.batch && (' Batch ' + d.batch)) ?> &mdash; <?= d.reqCode ?></th>
                <th class="py-2" align="right" style="border: 0!important; text-align: right"><?= d.id ?></th>
            </tr>
        </table>
      </th>
    </tr>    
  </thead>


<!-- Status -->

  <tbody style="white-space: pre-wrap;">
    <tr class="table-primary">
      <th scope="row" style="min-width: 215px">Status</th>
      <td><?= d.status ?></td>
    </tr>
    <tr>
      <th scope="row">Position in Queue</th>
      <td><?= ord(info.pos) ?></td>
    </tr>
    <tr>
      <th scope="row">Estimated Return Date</th>
      <td><?= (d.expRetDate && d.expRetDate.format(ldf)) || "(not estimated yet)" ?></td>
    </tr>
    <tr>
      <th scope="row">Assignee</th>
      <td><?= d.asst || "(not assigned)" ?></td>
    </tr>


<!-- Timeline -->

    <tr class="table-dark">
      <th scope="col" colspan="2">Timeline</th>
    </tr>

<? if (d.dCPL) { ?>
    <tr>
      <th scope="row">Date Completed</th>
      <td><?= d.dCPL.format(ldtf) ?></td>
    </tr>

<? } if (d.hardDueDate) { ?>
    <tr>
      <th scope="row">Hard Deadline</th>
      <td><?= d.hardDueDate.format(ldtf) ?></td>
    </tr>

<? } if (d.prefDueDate) { ?>
    <tr>
      <th scope="row">Preferred Deadline</th>
      <td><?= d.prefDueDate.format(ldf) ?></td>
    </tr>

<? } if (d.dRet) { ?>
    <tr>
      <th scope="row">Request First Returned</th>
      <td><?= d.dRet.format(ldtf) ?></td>
    </tr>

<? } if (d.dINP) { ?>
    <tr>
      <th scope="row">Request Started</th>
      <td><?= d.dINP.format(ldtf) ?></td>
    </tr>

<? } if (d.dFiles) { ?>
    <tr>
      <th scope="row">Files Received</th>
      <td><?= d.dFiles.format(ldtf) ?></td>
    </tr>

<? } if (d.startDate) { ?>
    <tr>
      <th scope="row">Files Expected</th>
      <td><?= d.startDate.format(ldf) ?></td>
    </tr>

<? } if (d.timestamp) { ?>
    <tr>
      <th scope="row">Request Received</th>
      <td><?= d.timestamp.format(ldtf) ?></td>
    </tr>

<? } ?>


<!-- Request Basics -->

<tr class="table-dark">
      <th scope="col" colspan="2">Request Basics</th>
    </tr>

<? if (d.reqType) { ?>
    <tr>
      <th scope="row">Type</th>
      <td><?= d.reqType ?></td>
    </tr>

<? } if (d.batch) { ?>
    <tr>
      <th scope="row">Batch</th>
      <td><?= d.batch ?></td>
    </tr>

<? } if (d.langsV001) { ?>
    <tr>
      <th scope="row">Languages (v0.01)</th>
      <td><?= d.langsV001 ?></td>
    </tr>

<? } if (d.langsCR) { ?>
    <tr>
      <th scope="row">Languages (corrections)</th>
      <td><?= d.langsCR ?></td>
    </tr>

<? } if (d.cpyast) { ?>
    <tr>
      <th scope="row">Copyrighted Assessments</th>
      <td><?= d.cpyast ?></td>
    </tr>

<? } if (d.nonast) { ?>
    <tr>
      <th scope="row">Non-Copyrighted Assessments</th>
      <td><?= d.nonast ?></td>
    </tr>

<? } if (d.langCnt) { ?>
    <tr>
      <th scope="row"># Languages</th>
      <td><?= d.langCnt ?></td>
    </tr>

<? } if (d.astCnt) { ?>
    <tr>
      <th scope="row"># Assessments</th>
      <td><?= d.astCnt ?></td>
    </tr>

<? } if (d.bestwkbks) { ?>
    <tr>
      <th scope="row">Workbooks</th>
      <td><?= d.bestwkbks + (!d.actwkbks ? " (predicted)" : '') ?></td>
    </tr>
<? } ?>


<!-- Performance Notes -->

<? if (d.majIssues || d.minIssues || d.gennotes || d.vendiss) { ?>
    <tr class="table-dark">
      <th scope="col" colspan="2">Performance Notes</th>
    </tr>

<? if (d.majIssues) { ?>
    <tr>
      <th scope="row">Major Issues (Blockers)</th>
      <td><?= d.majIssues ?></td>
    </tr>

<? } if (d.minIssues) { ?>
    <tr>
      <th scope="row">Minor Issues</th>
      <td><?= d.minIssues ?></td>
    </tr>

<? } if (d.gennotes) { ?>
    <tr>
      <th scope="row">General Notes</th>
      <td><?= d.gennotes ?></td>
    </tr>

<? } if (d.vendiss) { ?>
    <tr>
      <th scope="row">Vendor Mistakes</th>
      <td><?= d.vendiss ?></td>
    </tr>
<? } } ?>


<!-- Follow-up -->

<? if (d.tcfdbk || d.waitfor || d.jira) { ?>
    <tr class="table-dark">
      <th scope="col" colspan="2">Follow-up</th>
    </tr>

<? if (d.tcfdbk) { ?>
    <tr>
      <th scope="row">Requestor Feedback</th>
      <td><?= d.tcfdbk ?></td>
    </tr>

<? } if (d.waitfor) { ?>
    <tr>
      <th scope="row">On-hold: Waiting For</th>
      <td><?= d.waitfor ?></td>
    </tr>

<? } if (d.jira) { ?>
    <tr>
      <th scope="row">Associated JIRA Defects</th>
      <td><?= d.jira ?></td>
    </tr>
<? } } ?>


<!-- Request Details -->

<? if (d.dvcbld || d.msgbx || d.manscr || d.temp || d.naming || d.server || d.addnotes) { ?>
    <tr class="table-dark">
      <th scope="col" colspan="2">Request Details</th>
    </tr>

<? if (d.dvcbld) { ?>
    <tr>
      <th scope="row">Device &amp; Build</th>
      <td><?= d.dvcbld ?></td>
    </tr>

<? } if (d.msgbx) { ?>
    <tr>
      <th scope="row">Messageboxes Required</th>
      <td><?= d.msgbx ?></td>
    </tr>

<? } if (d.manscr) { ?>
    <tr>
      <th scope="row">Manual Screen Capture Required</th>
      <td><?= d.manscr ?></td>
    </tr>

<? } if (d.temp) { ?>
    <tr>
      <th scope="row">Excel Template</th>
      <td><?= d.temp ?></td>
    </tr>

<? } if (d.naming) { ?>
    <tr>
      <th scope="row">Naming Conventions</th>
      <td><?= d.naming ?></td>
    </tr>

<? } if (d.server) { ?>
    <tr>
      <th scope="row">Server</th>
      <td><?= d.server ?></td>
    </tr>

<? } if (d.addnotes) { ?>
    <tr>
      <th scope="row">Additional Notes</th>
      <td><?= d.addnotes ?></td>
    </tr>
<? } } ?>


  </tbody>
</table>